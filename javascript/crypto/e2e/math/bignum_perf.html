<!DOCTYPE html>
<html>
<!--
Copyright 2014 The Closure Library Authors. All Rights Reserved.

Use of this source code is governed by the Apache License, Version 2.0.
See the COPYING file for details.

Author:  fy@google.com (Frank Yellin)
-->
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>BigNum Performance Tests</title>
<link rel="stylesheet" type="text/css" href="../../closure/testing/performancetable.css"/>
<script src="../../../closure/base.js"></script>
<script src="deps.js"></script>
<script src="test_js_deps-runfiles.js"></script>
<script>
  goog.require('e2e.BigNum');
  goog.require('e2e.bigNumTestData');
  goog.require('e2e.BigPrimeNum');
  goog.require('e2e.FastModulus');
  goog.require('e2e.ecc.DomainParam');
  goog.require('e2e.ecc.PrimeCurve');
  goog.require('goog.array');
  goog.require('goog.dom');
  goog.require('goog.testing.PerformanceTable');
  goog.require('goog.testing.PerformanceTimer');
  goog.require('goog.testing.jsunit');
</script>

</head>
<body>
<h1>BigNum Performance tests</h1>
<p>
<strong>User-agent:</strong>
<script>document.write(navigator.userAgent);</script>
</p>

<script>

/**
 * Runs performance tests.
 *
 * The argument to this method should be an array of benchmark tests.  Each
 * element of the array is of the form {benchmark: <function>, label:name}
 *
 * @param {!Array.<{benchmark:!function():*, label:string}>} benchmarks
 *     An array consisting of things we want to time, and the name to show
 *     for it in the performance table.
 */
var runPerfTest = function(benchmarks) {
  var timer = new goog.testing.PerformanceTimer(10);
  var body = goog.dom.getDocument().body;
  var perfTable = goog.dom.createElement('div');
  goog.dom.appendChild(body, perfTable);
  var table = new goog.testing.PerformanceTable(perfTable, timer);
  goog.array.forEach(benchmarks, function(benchmark) {
    table.run(benchmark.benchmark, benchmark.label);
  });
};


/**
 * Benchmarks.
 */
var runBenchmark = function() {
  var P256 = new e2e.BigNum(e2e.bigNumTestData.P_256);
  var A = new e2e.BigNum(e2e.bigNumTestData.A);
  var B = new e2e.BigNum(e2e.bigNumTestData.B);

  var P512 = P256.multiply(P256);
  var params = e2e.ecc.DomainParam.fromCurve(
      e2e.ecc.PrimeCurve.P_256);

  var TIMES = 100000;
  var tests = [
    {
      benchmark: function() {
          for (var i = 0; i < TIMES; ++i) params.n.residue(P512); },
      label: 'FastModulusFFFFFF.residue'
    },
    {
      benchmark: function() {
          for (var i = 0; i < TIMES; ++i) P512.mod(params.n); },
      label: 'BigNum.mod params.n'
    },
    {
      benchmark: function() {
          for (var i = 0; i < TIMES; ++i) params.curve.q.residue(P512); },
      label: 'FastModulus.NIST.P_256.residue'
    },
    {
      benchmark: function() {
          for (var i = 0; i < TIMES; ++i) P512.mod(params.curve.q); },
      label: 'BigNum.mod params.curve.q'
    },
    {
      benchmark: function() {
          for (var i = 0; i < TIMES; ++i) params.curve.q.modMultiply(A, B); },
      label: 'modMultiply with residue'
    },
    {
      benchmark: function() {
          for (var i = 0; i < TIMES; ++i) params.curve.q.modMul_(A, B); },
      label: 'modMultiply with Montgomery'
    }
  ];
  runPerfTest(tests);
};

function testP256() {
  runBenchmark();
}


</script>
</body>
</html>
